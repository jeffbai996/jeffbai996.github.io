import{u as G,c as Y,d as _,j as e,A as U,e as c,C as j,f as T,h as E,s as J,i as Q,t as X,r as Z}from"./index-F9qqBUq8.js";import{c as r,L as ee}from"./vendor-react-Cv6iu0DG.js";import"./vendor-supabase-BUqPLCfl.js";import"./chatbot-utils-BA5qZPu5.js";import"./vendor-google-BpRkNtKl.js";const se=["Office of the Chief Executive","National Police Agency","National Weather Service","Department of Health","Transport Department","Revenue Department","Housing Authority","Digital Services","National Emergency Management","Bank of Praya","Interior Department","Justice Department","Other"];function ne(){var w,k,S,A,C,D;const{user:o}=G(),[g,L]=r.useState([]),[M,h]=r.useState(!1),[t,d]=r.useState(null),[F,x]=r.useState(null),[y,u]=r.useState(!1),[v,N]=r.useState(null),[p,O]=r.useState(null),[I,b]=r.useState(!0);r.useEffect(()=>{m(),R()},[]);const m=async()=>{b(!0);try{const s=await Y();L(s)}catch{l("Failed to load alerts","error")}finally{b(!1)}},R=async()=>{const s=await _();O(s)},l=(s,a="success")=>{N({message:s,type:a}),setTimeout(()=>N(null),3e3)},f=()=>{d({id:null,title:"",message:"",severityKey:"INFO",category:E.GOVERNMENT,department:"Digital Services",timestamp:new Date().toISOString().slice(0,16),expiresAt:new Date(Date.now()+10080*60*1e3).toISOString().slice(0,16),dismissible:!0,link:"",linkText:"",isActive:!0}),u(!1),h(!0)},B=s=>{d({id:null,title:s.title,message:s.message,severityKey:s.severityKey,category:s.category,department:s.department,timestamp:new Date().toISOString().slice(0,16),expiresAt:new Date(Date.now()+10080*60*1e3).toISOString().slice(0,16),dismissible:!0,link:s.link||"",linkText:s.linkText||"",isActive:!0}),u(!1),h(!0)},W=s=>{d({...s,timestamp:s.timestamp instanceof Date?s.timestamp.toISOString().slice(0,16):new Date(s.timestamp).toISOString().slice(0,16),expiresAt:s.expiresAt instanceof Date?s.expiresAt.toISOString().slice(0,16):new Date(s.expiresAt).toISOString().slice(0,16)}),h(!0)},K=async s=>{s.preventDefault();try{const a=await J(t);a.success?(l(`Alert ${t.id?"updated":"created"} successfully`+(a.source==="supabase"?" (synced to cloud)":" (saved locally)")),h(!1),d(null),await m()):l("Failed to save alert: "+a.error,"error")}catch{l("Failed to save alert","error")}},P=async s=>{try{(await Q(s)).success?(l("Alert deleted"),x(null),await m()):l("Failed to delete alert","error")}catch{l("Failed to delete alert","error")}},q=async s=>{try{const a=await X(s);a.success&&(l(a.isActive?"Alert activated":"Alert deactivated"),await m())}catch{l("Failed to toggle alert","error")}},$=()=>{window.confirm("Reset all alerts to defaults? This will delete all custom alerts.")&&(Z(),l("Alerts reset to defaults"),m())},H=()=>{h(!1),d(null)},i=(s,a)=>{d(n=>({...n,[s]:a}))},V=s=>{const a=new Date,n=new Date(s.timestamp),z=new Date(s.expiresAt);return s.isActive?a<n?{label:"Scheduled",className:"status-scheduled"}:a>z?{label:"Expired",className:"status-expired"}:{label:"Active",className:"status-active"}:{label:"Inactive",className:"status-inactive"}};return e.jsxs("div",{className:"alert-admin",children:[e.jsx("header",{className:"admin-header",children:e.jsxs("div",{className:"admin-header-content",children:[e.jsxs(ee,{to:"/",className:"admin-back-link",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back to Portal"]}),e.jsxs("div",{className:"admin-title",children:[e.jsx("h1",{children:"Emergency Alert Management"}),e.jsx("p",{children:"Create and manage government alerts displayed on GOV.PRAYA"})]}),e.jsxs("div",{className:"admin-user",children:[e.jsxs("span",{className:"admin-user-name",children:[o==null?void 0:o.firstName," ",o==null?void 0:o.lastName]}),p&&e.jsx("span",{className:`storage-badge ${p.usingSupabase?"cloud":"local"}`,children:p.usingSupabase?e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"})}),"Cloud Sync"]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),e.jsx("path",{d:"M8 21h8M12 17v4"})]}),"Local Storage"]})})]})]})}),v&&e.jsx("div",{className:`admin-notification ${v.type}`,children:v.message}),e.jsx("main",{className:"admin-main",children:e.jsx("div",{className:"admin-container",children:I?e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading alerts..."})]}):M?e.jsxs("div",{className:"alert-form-container",children:[e.jsx("h2",{children:t!=null&&t.id?"Edit Alert":"Create New Alert"}),e.jsxs("form",{onSubmit:K,className:"alert-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"severity",children:"Severity Level"}),e.jsx("select",{id:"severity",value:(t==null?void 0:t.severityKey)||"INFO",onChange:s=>i("severityKey",s.target.value),required:!0,children:Object.entries(c).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Category"}),e.jsx("select",{id:"category",value:(t==null?void 0:t.category)||"government",onChange:s=>i("category",s.target.value),required:!0,children:Object.entries(E).map(([s,a])=>e.jsx("option",{value:a,children:j[a]},s))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Alert Title"}),e.jsx("input",{type:"text",id:"title",value:(t==null?void 0:t.title)||"",onChange:s=>i("title",s.target.value),placeholder:"e.g., Winter Weather Advisory",required:!0,maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"message",children:"Alert Message"}),e.jsx("textarea",{id:"message",value:(t==null?void 0:t.message)||"",onChange:s=>i("message",s.target.value),placeholder:"Provide details about the alert...",required:!0,rows:4,maxLength:500}),e.jsxs("span",{className:"char-count",children:[((w=t==null?void 0:t.message)==null?void 0:w.length)||0,"/500"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"department",children:"Issuing Department"}),e.jsx("select",{id:"department",value:(t==null?void 0:t.department)||"Digital Services",onChange:s=>i("department",s.target.value),required:!0,children:se.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"timestamp",children:"Start Date & Time"}),e.jsx("input",{type:"datetime-local",id:"timestamp",value:(t==null?void 0:t.timestamp)||"",onChange:s=>i("timestamp",s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"expiresAt",children:"Expiration Date & Time"}),e.jsx("input",{type:"datetime-local",id:"expiresAt",value:(t==null?void 0:t.expiresAt)||"",onChange:s=>i("expiresAt",s.target.value),required:!0})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"link",children:"Link URL (optional)"}),e.jsx("input",{type:"text",id:"link",value:(t==null?void 0:t.link)||"",onChange:s=>i("link",s.target.value),placeholder:"e.g., /transport or https://..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"linkText",children:"Link Text (optional)"}),e.jsx("input",{type:"text",id:"linkText",value:(t==null?void 0:t.linkText)||"",onChange:s=>i("linkText",s.target.value),placeholder:"e.g., Learn More"})]})]}),e.jsxs("div",{className:"form-row form-options",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(t==null?void 0:t.dismissible)??!0,onChange:s=>i("dismissible",s.target.checked)}),e.jsx("span",{children:"Allow users to dismiss this alert"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(t==null?void 0:t.isActive)??!0,onChange:s=>i("isActive",s.target.checked)}),e.jsx("span",{children:"Alert is active"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:t!=null&&t.id?"Save Changes":"Create Alert"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:H,children:"Cancel"})]})]}),t&&e.jsxs("div",{className:"alert-preview",children:[e.jsx("h3",{children:"Preview"}),e.jsxs("div",{className:"preview-banner",style:{"--alert-color":(k=c[t.severityKey])==null?void 0:k.color,"--alert-bg":(S=c[t.severityKey])==null?void 0:S.bgColor,"--alert-border":(A=c[t.severityKey])==null?void 0:A.borderColor},children:[e.jsx("div",{className:"preview-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:T((C=c[t.severityKey])==null?void 0:C.icon)})})}),e.jsxs("div",{className:"preview-content",children:[e.jsx("span",{className:"preview-badge",children:(D=c[t.severityKey])==null?void 0:D.label}),e.jsx("span",{className:"preview-title",children:t.title||"Alert Title"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-toolbar",children:[e.jsxs("div",{className:"toolbar-left",children:[e.jsxs("button",{className:"btn btn-primary",onClick:f,children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"New Alert"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u(!y),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),"Templates"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:$,children:"Reset to Defaults"})]}),y&&e.jsxs("div",{className:"templates-panel",children:[e.jsx("h3",{children:"Quick Templates"}),e.jsx("p",{children:"Start with a pre-configured template and customize as needed."}),e.jsx("div",{className:"templates-grid",children:U.map(s=>{const a=c[s.severityKey];return e.jsxs("button",{className:"template-card",onClick:()=>B(s),style:{"--severity-color":a.color},children:[e.jsxs("div",{className:"template-header",children:[e.jsx("span",{className:"template-severity",style:{background:a.color},children:a.label}),e.jsx("span",{className:"template-category",children:j[s.category]})]}),e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.title})]},s.id)})})]}),e.jsx("div",{className:"alerts-list",children:g.length===0?e.jsxs("div",{className:"alerts-empty",children:[e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h3",{children:"No Alerts"}),e.jsx("p",{children:"Create your first alert to display on the government portal."}),e.jsx("button",{className:"btn btn-primary",onClick:f,children:"Create Alert"})]}):g.map(s=>{const a=V(s),n=c[s.severityKey]||s.severity;return e.jsxs("div",{className:`alert-item ${a.className}`,style:{"--severity-color":n.color},children:[e.jsx("div",{className:"alert-item-indicator"}),e.jsx("div",{className:"alert-item-icon",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:T(n.icon)})})}),e.jsxs("div",{className:"alert-item-content",children:[e.jsxs("div",{className:"alert-item-header",children:[e.jsx("span",{className:"alert-item-severity",style:{background:n.color},children:n.label}),e.jsx("span",{className:"alert-item-category",children:j[s.category]||s.category}),e.jsx("span",{className:`alert-item-status ${a.className}`,children:a.label})]}),e.jsx("h3",{className:"alert-item-title",children:s.title}),e.jsx("p",{className:"alert-item-message",children:s.message}),e.jsxs("div",{className:"alert-item-meta",children:[e.jsx("span",{children:s.department}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Starts: ",new Date(s.timestamp).toLocaleString()]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Expires: ",new Date(s.expiresAt).toLocaleString()]})]})]}),e.jsxs("div",{className:"alert-item-actions",children:[e.jsx("button",{className:`action-btn ${s.isActive?"active":""}`,onClick:()=>q(s.id),title:s.isActive?"Deactivate":"Activate",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.isActive?e.jsx("path",{d:"M18.36 6.64a9 9 0 11-12.73 0M12 2v10"}):e.jsx("path",{d:"M12 2v10m0 0a9 9 0 109 9"})})}),e.jsx("button",{className:"action-btn",onClick:()=>W(s),title:"Edit",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{className:"action-btn danger",onClick:()=>x(s.id),title:"Delete",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]}),F===s.id&&e.jsxs("div",{className:"delete-confirm",children:[e.jsx("p",{children:"Delete this alert?"}),e.jsxs("div",{className:"delete-confirm-actions",children:[e.jsx("button",{className:"btn btn-danger",onClick:()=>P(s.id),children:"Delete"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>x(null),children:"Cancel"})]})]})]},s.id)})})]})})})]})}export{ne as default};
